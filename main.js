!function(t){var r={};function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(n,e){if(1&e&&(n=o(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)o.d(t,r,function(e){return n[e]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=5)}([function(e,n,t){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.IncomingMessageType=void 0,(r=n.IncomingMessageType||(n.IncomingMessageType={})).ERROR="ERROR",r.LOGIN="LOGIN",r.LOGOUT="LOGOUT",r.SEND_OFFER="SEND_OFFER",r.SEND_ANSWER="SEND_ANSWER",r.SEND_CANDIDATE="SEND_CANDIDATE"},function(e,n,t){"use strict";var o=this&&this.__awaiter||function(e,u,s,a){return new(s=s||Promise)(function(t,n){function r(e){try{i(a.next(e))}catch(e){n(e)}}function o(e){try{i(a.throw(e))}catch(e){n(e)}}function i(e){var n;e.done?t(e.value):((n=e.value)instanceof s?n:new s(function(e){e(n)})).then(r,o)}i((a=a.apply(e,u||[])).next())})},i=this&&this.__generator||function(t,r){var o,i,u,s={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},e={next:n(0),throw:n(1),return:n(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(u=2&n[0]?i.return:n[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[2&n[0],u.value]),n[0]){case 0:case 1:u=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(u=0<(u=s.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){s.label=n[1];break}if(6===n[0]&&s.label<u[1]){s.label=u[1],u=n;break}if(u&&s.label<u[2]){s.label=u[2],s.ops.push(n);break}u[2]&&s.ops.pop(),s.trys.pop();continue}n=r.call(t,s)}catch(e){n=[6,e],i=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.playAudio=n.captureAudio=void 0,n.captureAudio=function(){return navigator.mediaDevices.getUserMedia({audio:!0})},n.playAudio=function(r){return o(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return n=r,(t=document.createElement("audio")).srcObject=n,document.body.appendChild(t),[4,t.play()];case 1:return e.sent(),console.log("playing"),[2]}var n,t})})}},function(e,n,t){"use strict";function i(e){var n=document.querySelector(e);if(n)return n.innerHTML="",n;var t=document.createElement("div");return t.id=e.substr(1),document.body.appendChild(t),t}function u(e,n){var t=document.createElement("button");return t.innerHTML=e,t.onclick=n,t}Object.defineProperty(n,"__esModule",{value:!0}),n.renderUsers=n.renderMessage=n.renderCTA=n.renderUsername=void 0,n.renderUsername=function(e){i("#username").innerHTML="<h1>"+e+"</h1>"},n.renderCTA=function(e,n){var t=i("#cta"),r=u(e,function(){t.innerHTML="",n()});t.appendChild(document.createElement("hr")),t.appendChild(r)},n.renderMessage=function(e){i("#message").innerHTML=e},n.renderUsers=function(e,t){for(var r=i("#userlist"),n=0,o=e;n<o.length;n++){!function(e){var n=document.createElement("div");n.appendChild(u(e.name,function(){return t(e)})),r.appendChild(n)}(o[n])}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.send=n.onMessage=void 0;var r,o,i=t(4);function u(){r=new WebSocket("wss://amongus.amatiasq.com"),i.logAllEvents(r,"WebSocket"),r.onerror=function(){console.warn("Socket closed. Retrying..."),s()},r.onclose=function(){console.warn("Socket closed. Retrying..."),s()},o&&(r.onmessage=o)}function s(){setTimeout(function(){console.log("Reconnecting..."),u()},1e3)}u(),n.onMessage=function(n){o=r.onmessage=function(e){return n(JSON.parse(e.data))}},n.send=function(e){r.send(JSON.stringify(e))}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.logAllEvents=void 0,n.logAllEvents=function(e,t){(function(e){var n=[],t=e;for(;t;)n.push.apply(n,Object.keys(t)),t=Object.getPrototypeOf(t);return function(e){return Array.from(new Set(e))}(n)})(e).filter(function(e){return e.startsWith("on")}).map(function(n){return e[n]=function(e){return console.debug(t+' event "'+n+'"',e)}})}},function(e,n,t){"use strict";var r=this&&this.__awaiter||function(e,u,s,a){return new(s=s||Promise)(function(t,n){function r(e){try{i(a.next(e))}catch(e){n(e)}}function o(e){try{i(a.throw(e))}catch(e){n(e)}}function i(e){var n;e.done?t(e.value):((n=e.value)instanceof s?n:new s(function(e){e(n)})).then(r,o)}i((a=a.apply(e,u||[])).next())})},o=this&&this.__generator||function(t,r){var o,i,u,s={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},e={next:n(0),throw:n(1),return:n(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(u=2&n[0]?i.return:n[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[2&n[0],u.value]),n[0]){case 0:case 1:u=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(u=0<(u=s.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){s.label=n[1];break}if(6===n[0]&&s.label<u[1]){s.label=u[1],u=n;break}if(u&&s.label<u[2]){s.label=u[2],s.ops.push(n);break}u[2]&&s.ops.pop(),s.trys.pop();continue}n=r.call(t,s)}catch(e){n=[6,e],i=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var i=t(0),u=t(6),s=t(1),a=t(2),c=t(7),l=t(3),f=[];function d(t){return r(this,void 0,void 0,function(){var n;return o(this,function(e){switch(e.label){case 0:return[4,s.captureAudio()];case 1:return n=e.sent(),console.log("sending audio"),n.getTracks().forEach(function(e){return c.addTrack(e,n)}),[4,c.connectToUser(t)];case 2:return e.sent(),[2]}})})}l.onMessage(function(e){switch(e.type){case u.OutgoingMessageType.HANDSHAKE:return function(){var e=sessionStorage.getItem("amongus:username");for(;!e;)e=prompt("Username");sessionStorage.setItem("amongus:username",e),a.renderUsername(e),a.renderMessage(""),l.send({type:i.IncomingMessageType.LOGIN,name:e})}();case u.OutgoingMessageType.LOGIN_RESULT:return function(e){if(e.type!==u.OutgoingMessageType.LOGIN_RESULT)return;if(!e.success)return console.error("LOGIN FAILED: "+e.message);f=e.users,a.renderUsers(f,d)}(e);case u.OutgoingMessageType.USER_CONNECTED:return t=e.user,console.log("CONNECTED",t),f.push(t),void a.renderUsers(f,d);case u.OutgoingMessageType.USER_DISCONNECTED:return n=e.user,console.log("DISCONNECTED",n),f=f.filter(function(e){return e.id!==n.id}),void a.renderUsers(f,d);case u.OutgoingMessageType.RECEIVE_OFFER:return c.onOffer(e.from,e.offer);case u.OutgoingMessageType.RECEIVE_ANSWER:return function(n,t){return r(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,c.onAnswer(n,t)];case 1:return e.sent(),[2]}})})}(e.from,e.answer);case u.OutgoingMessageType.RECEIVE_CANDIDATE:return c.onCandidate(e.from,e.candidate);default:console.log("Unhandled message: "+e.type)}var n,t})},function(e,n,t){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.OutgoingMessageType=void 0,(r=n.OutgoingMessageType||(n.OutgoingMessageType={})).ERROR="ERROR",r.HANDSHAKE="HANDSHAKE",r.LOGIN_RESULT="LOGIN_RESULT",r.USER_CONNECTED="USER_CONNECTED",r.USER_DISCONNECTED="USER_DISCONNECTED",r.RECEIVE_OFFER="RECEIVE_OFFER",r.RECEIVE_ANSWER="RECEIVE_ANSWER",r.RECEIVE_CANDIDATE="RECEIVE_CANDIDATE"},function(e,n,t){"use strict";var i=this&&this.__awaiter||function(e,u,s,a){return new(s=s||Promise)(function(t,n){function r(e){try{i(a.next(e))}catch(e){n(e)}}function o(e){try{i(a.throw(e))}catch(e){n(e)}}function i(e){var n;e.done?t(e.value):((n=e.value)instanceof s?n:new s(function(e){e(n)})).then(r,o)}i((a=a.apply(e,u||[])).next())})},u=this&&this.__generator||function(t,r){var o,i,u,s={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},e={next:n(0),throw:n(1),return:n(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(u=2&n[0]?i.return:n[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[2&n[0],u.value]),n[0]){case 0:case 1:u=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(u=0<(u=s.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){s.label=n[1];break}if(6===n[0]&&s.label<u[1]){s.label=u[1],u=n;break}if(u&&s.label<u[2]){s.label=u[2],s.ops.push(n);break}u[2]&&s.ops.pop(),s.trys.pop();continue}n=r.call(t,s)}catch(e){n=[6,e],i=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.addTrack=n.onCandidate=n.onAnswer=n.onOffer=n.connectToUser=void 0;var r=t(8),s=t(0),o=t(1),a=t(3),c=t(2),l=t(4),f=new RTCPeerConnection({iceServers:r()}),d=null;n.connectToUser=function(o){return i(this,void 0,void 0,function(){function n(e){var n=e.data;console.log("POLLAS",n)}var t,r;return u(this,function(e){switch(e.label){case 0:return(t=f.createDataChannel("messenger")).onerror=function(e){return console.error("Error connecting to user",e)},t.onmessage=n,d=o.name,[4,f.createOffer({offerToReceiveAudio:!0})];case 1:return r=e.sent(),[4,f.setLocalDescription(r)];case 2:return e.sent(),[4,a.send({type:s.IncomingMessageType.SEND_OFFER,to:o.name,offer:f.localDescription})];case 3:return e.sent(),[2]}})})},n.onOffer=function(t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(e){switch(e.label){case 0:return[4,f.setRemoteDescription(new RTCSessionDescription(r))];case 1:return e.sent(),[4,f.createAnswer({offerToReceiveAudio:!0})];case 2:return n=e.sent(),[4,f.setLocalDescription(n)];case 3:return e.sent(),[4,a.send({type:s.IncomingMessageType.SEND_ANSWER,to:t,answer:f.localDescription})];case 4:return e.sent(),[2]}})})},n.onAnswer=function(e,n){return f.setRemoteDescription(new RTCSessionDescription(n))},n.onCandidate=function(e,n){f.addIceCandidate(new RTCIceCandidate(n))},n.addTrack=function(e,n){f.addTrack(e,n)},l.logAllEvents(f,"WebRTC"),f.onicecandidate=function(e){var n=e.candidate;console.log("Candidate ready"),n&&d&&a.send({type:s.IncomingMessageType.SEND_CANDIDATE,to:d,candidate:n})},f.ondatachannel=function(e){var n=e.channel;n.onmessage=function(e){var n=e.data;console.log("POLLAS2",n)},n.onopen=function(){console.log("Data channel is open and ready to be used.")}},f.ontrack=function(e){console.log("got track"),c.renderCTA("Someone is calling you... ANSWER",function(){return o.playAudio(e.streams[0])})}},function(e,n,o){"use strict";var u=o(9);e.exports=function(e){var n,i={stun:(e||{}).stun||o(10),turn:(e||{}).turn||o(11)},t=(e||{}).turnCount||0;function r(n,e){for(var t,r=[],o=[].concat(i[n]);o.length&&r.length<e;)t=Math.random()*o.length|0,r=r.concat(o.splice(t,1));return r.map(function(e){return"string"==typeof e||e instanceof String?u(n+":"+e):e})}return n=[].concat(r("stun",(e||{}).stunCount||2)),t&&(n=n.concat(r("turn",t))),n}},function(e,n){var i=["stun:","turn:"];e.exports=function(e){var n,t,r=(e||{}).url||e,o={};return"string"==typeof r||r instanceof String?(r=r.trim(),(n=i[i.indexOf(r.slice(0,5))])?(t=(r=r.slice(5)).split("@"),o.username=e.username,o.credential=e.credential,1<t.length&&(r=t[1],t=t[0].split(":"),o.username=t[0],o.credential=(e||{}).credential||t[1]||""),o.url=n+r,o.urls=[o.url],o):e):e}},function(e){e.exports=JSON.parse('["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]')},function(e){e.exports=JSON.parse("[]")}]);
//# sourceMappingURL=main.js.map